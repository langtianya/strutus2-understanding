
<!-- 
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE- 2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License. 
-->

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
  <HEAD>
    <LINK type="text/css" rel="stylesheet" href="https://struts.apache.org/css/default.css">
    <STYLE type="text/css">
      .dp-highlighter {
        width:95% !important;
      }
    </STYLE>
    <STYLE type="text/css">
      .footer {
        background-image:      url('https://cwiki.apache.org/confluence/images/border/border_bottom.gif');
        background-repeat:     repeat-x;
        background-position:   left top;
        padding-top:           4px;
        color:                 #666;
      }
    </STYLE>
    <SCRIPT type="text/javascript" language="javascript">
      var hide = null;
      var show = null;
      var children = null;

      function init() {
        /* Search form initialization */
        var form = document.forms['search'];
        if (form != null) {
          form.elements['domains'].value = location.hostname;
          form.elements['sitesearch'].value = location.hostname;
        }

        /* Children initialization */
        hide = document.getElementById('hide');
        show = document.getElementById('show');
        children = document.all != null ?
                   document.all['children'] :
                   document.getElementById('children');
        if (children != null) {
          children.style.display = 'none';
          show.style.display = 'inline';
          hide.style.display = 'none';
        }
      }

      function showChildren() {
        children.style.display = 'block';
        show.style.display = 'none';
        hide.style.display = 'inline';
      }

      function hideChildren() {
        children.style.display = 'none';
        show.style.display = 'inline';
        hide.style.display = 'none';
      }
    </SCRIPT>
    <TITLE>Portlet Plugin</TITLE>
  <META http-equiv="Content-Type" content="text/html;charset=UTF-8"></HEAD>
  <BODY onload="init()">
    <TABLE border="0" cellpadding="2" cellspacing="0" width="100%">
      <TR class="topBar">
        <TD align="left" valign="middle" class="topBarDiv" align="left" nowrap="">
          &nbsp;<A href="home.html" title="Apache Struts 2 Documentation">Apache Struts 2 Documentation</A>&nbsp;&gt;&nbsp;<A href="home.html" title="Home">Home</A>&nbsp;&gt;&nbsp;<A href="guides.html" title="Guides">Guides</A>&nbsp;&gt;&nbsp;<A href="plugin-developers-guide.html" title="Plugin Developers Guide">Plugin Developers Guide</A>&nbsp;&gt;&nbsp;<A href="" title="Portlet Plugin">Portlet Plugin</A>
        </TD>
        <TD align="right" valign="middle" nowrap="">
          <FORM name="search" action="http://www.google.com/search" method="get">
            <INPUT type="hidden" name="ie" value="UTF-8">
            <INPUT type="hidden" name="oe" value="UTF-8">
            <INPUT type="hidden" name="domains" value="">
            <INPUT type="hidden" name="sitesearch" value="">
            <INPUT type="text" name="q" maxlength="255" value="">        
            <INPUT type="submit" name="btnG" value="Google Search">
          </FORM>
        </TD>
      </TR> 
    </TABLE>

    <DIV id="PageContent">
      <DIV class="pageheader" style="padding: 6px 0px 0px 0px;">
        <!-- We'll enable this once we figure out how to access (and save) the logo resource -->
        <!--img src="/wiki/images/confluence_logo.gif" style="float: left; margin: 4px 4px 4px 10px;" border="0"-->
        <DIV style="margin: 0px 10px 0px 10px" class="smalltext">Apache Struts 2 Documentation</DIV>
        <DIV style="margin: 0px 10px 8px 10px" class="pagetitle">Portlet Plugin</DIV>

        <DIV class="greynavbar" align="right" style="padding: 2px 10px; margin: 0px;">
          <A href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=74033">
            <IMG src="https://cwiki.apache.org/confluence/images/icons/notep_16.gif" height="16" width="16" border="0" align="absmiddle" title="Edit Page"></A>
            <A href="https://cwiki.apache.org/confluence/pages/editpage.action?pageId=74033">Edit Page</A>
          &nbsp;
          <A href="https://cwiki.apache.org/confluence/pages/listpages.action?key=WW">
            <IMG src="https://cwiki.apache.org/confluence/images/icons/browse_space.gif" height="16" width="16" border="0" align="absmiddle" title="Browse Space"></A>
            <A href="https://cwiki.apache.org/confluence/pages/listpages.action?key=WW">Browse Space</A>
          &nbsp;
          <A href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=WW&fromPageId=74033">
            <IMG src="https://cwiki.apache.org/confluence/images/icons/add_page_16.gif" height="16" width="16" border="0" align="absmiddle" title="Add Page"></A>
          <A href="https://cwiki.apache.org/confluence/pages/createpage.action?spaceKey=WW&fromPageId=74033">Add Page</A>
          &nbsp;
          <A href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=WW&fromPageId=74033">
            <IMG src="https://cwiki.apache.org/confluence/images/icons/add_blogentry_16.gif" height="16" width="16" border="0" align="absmiddle" title="Add News"></A>
          <A href="https://cwiki.apache.org/confluence/pages/createblogpost.action?spaceKey=WW&fromPageId=74033">Add News</A>
        </DIV>
      </DIV>

      <DIV class="pagecontent">
        <DIV class="wiki-content">
          <H1><A name="PortletPlugin-Documentation"></A>Documentation</H1>

<DIV class="panelMacro"><TABLE class="infoMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="https://cwiki.apache.org/confluence/images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD><B>The Portlet Plugin is used for developing JSR286 portlets using Struts 2.</B></TD></TR></TABLE></DIV>

<H2><A name="PortletPlugin-portletclass"></A>portlet-class</H2>

<P>To use the Struts 2 Portlet framework, use <B><EM>org.apache.struts2.portlet.dispatcher.Jsr286Dispatcher</EM></B> as the portlet class in your portlet.xml file:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>portlet.xml</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
&lt;?xml version=<SPAN class="code-quote">&quot;1.0&quot;</SPAN> encoding=<SPAN class="code-quote">&quot;UTF-8&quot;</SPAN>?&gt;

&lt;portlet-app id=<SPAN class="code-quote">&quot;my-portlet-app&quot;</SPAN>
	xmlns=<SPAN class="code-quote">&quot;http:<SPAN class="code-comment">//java.sun.com/xml/ns/portlet/portlet-app_2_0.xsd&quot;</SPAN>
</SPAN>	xmlns:xsi=<SPAN class="code-quote">&quot;http:<SPAN class="code-comment">//www.w3.org/2001/XMLSchema-instance&quot;</SPAN> version=<SPAN class="code-quote">&quot;2.0&quot;</SPAN>
</SPAN>	xsi:schemaLocation=<SPAN class="code-quote">&quot;http:<SPAN class="code-comment">//java.sun.com/xml/ns/portlet/portlet-app_2_0.xsd http://java.sun.com/xml/ns/portlet/portlet-app_2_0.xsd&quot;</SPAN>&gt;
</SPAN>
    &lt;portlet id=<SPAN class="code-quote">&quot;MyPortlet&quot;</SPAN>&gt;
        &lt;description xml:lang=<SPAN class="code-quote">&quot;EN&quot;</SPAN>&gt;My Portlet&lt;/description&gt;
        &lt;portlet-name&gt;MyPortlet&lt;/portlet-name&gt;
        &lt;display-name xml:lang=<SPAN class="code-quote">&quot;EN&quot;</SPAN>&gt;my-portlet&lt;/display-name&gt;
    
        &lt;portlet-class&gt;org.apache.struts2.portlet.dispatcher.Jsr286Dispatcher&lt;/portlet-class&gt;
        
        &lt;!-- SNIP --&gt;

    &lt;/portlet&gt;
&lt;/portlet-app&gt;
</PRE>
</DIV></DIV>

<H2><A name="PortletPlugin-PortletInitParameters"></A>Portlet Init Parameters</H2>

<P>Below is the init-param elements that you can set up in <EM>portlet.xml</EM> for configuring the portlet mode &#45;&gt; xwork namespace mappings for the portlet. Basically, you can think of the different portlet modes as different sub-applications, so it can be useful to set up the <TT>struts.xml</TT> configuration with different namespaces for the different portlets and modes:</P>
<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Key </TH>
<TH class="confluenceTh"> Description </TH>
<TH class="confluenceTh"> Default </TH>
</TR>
<TR>
<TD class="confluenceTd"> portletNamespace </TD>
<TD class="confluenceTd"> The namespace for the portlet in the action configuration. This namespace is prepended to all action lookups, and makes it possible to host multiple portlets in the same portlet application. If this parameter is set, the complete namespace will be <EM>/portletNamespace/modeNamespace/actionName</EM> </TD>
<TD class="confluenceTd"> The default namespace. </TD>
</TR>
<TR>
<TD class="confluenceTd"> viewNamespace </TD>
<TD class="confluenceTd"> The namespace in the xwork config for the view portlet mode. </TD>
<TD class="confluenceTd"> The default namespace. </TD>
</TR>
<TR>
<TD class="confluenceTd"> editNamespace </TD>
<TD class="confluenceTd"> The namespace in the xwork config for the edit portlet mode. </TD>
<TD class="confluenceTd"> The default namespace. </TD>
</TR>
<TR>
<TD class="confluenceTd"> helpNamespace </TD>
<TD class="confluenceTd"> The namespace in the xwork config for the help portlet mode. </TD>
<TD class="confluenceTd"> The default namespace. </TD>
</TR>
<TR>
<TD class="confluenceTd"> defaultViewAction </TD>
<TD class="confluenceTd"> Name of the action to use as default for the view portlet mode, when no action name is present. </TD>
<TD class="confluenceTd"> default </TD>
</TR>
<TR>
<TD class="confluenceTd"> defaultEditAction </TD>
<TD class="confluenceTd"> Name of the action to use as default for the edit portlet mode, when no action name is present. </TD>
<TD class="confluenceTd"> default </TD>
</TR>
<TR>
<TD class="confluenceTd"> defaultHelpAction </TD>
<TD class="confluenceTd"> Name of the action to use as default for the help portlet mode, when no action name is present. </TD>
<TD class="confluenceTd"> default </TD>
</TR>
</TBODY></TABLE>
</DIV>

<P>e.g.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>portlet.xml</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
&lt;init-param&gt;
    &lt;!-- Portlet namespace --&gt;
    &lt;name&gt;portletNamespace&lt;/name&gt;
    &lt;value&gt;/portletA&lt;/value&gt;
&lt;/init-param&gt;
&lt;init-param&gt;
    &lt;!-- The base namespace of the view portlet mode --&gt;
    &lt;name&gt;viewNamespace&lt;/name&gt;
    &lt;value&gt;/view&lt;/value&gt;
&lt;/init-param&gt;
&lt;init-param&gt;
    &lt;!-- The <SPAN class="code-keyword">default</SPAN> action to invoke in view mode --&gt;
    &lt;name&gt;defaultViewAction&lt;/name&gt;
    &lt;value&gt;index&lt;/value&gt;
&lt;/init-param&gt;
</PRE>
</DIV></DIV>
<P>This snippet from <TT>portlet.xml</TT> will set up the portlet with a namespace of <EM>/portletA/. This means that all requests to this portlet will get the namespace prepended when looking up the action. In addition, the &#95;view</EM> portlet mode will map to the <EM>/view</EM> namespace, so a request for action <TT>myAction</TT> will resolve to the namespace and action <EM>/portletA/view/myAction</EM>. It also means that if no action is requested, the default action of <TT>index</TT> will be used for the request.</P>

<H2><A name="PortletPlugin-web.xml"></A>web.xml</H2>

<P>If you want to access to expose the value stack through request attributes (e.g. if you want to use regular JSTL tags to access values in the stack), you have to configure the dispatcher servlet in your web application descriptor:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>web.xml</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
&lt;servlet id=<SPAN class="code-quote">&quot;Struts2PortletDispatcherServlet&quot;</SPAN>&gt;
    &lt;servlet-name&gt;Struts2PortletDispatcherServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.apache.struts2.portlet.dispatcher.DispatcherServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;
</PRE>
</DIV></DIV>

<DIV class="panelMacro"><TABLE class="noteMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="https://cwiki.apache.org/confluence/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD><B>If you're only using Struts 2 tags, configuring the dispatcher servlet is optional</B></TD></TR></TABLE></DIV>

<H2><A name="PortletPlugin-PortletPhases"></A>Portlet Phases</H2>

<P>The portlet specification describes that a portlet request cycle can consist of two phases, an <EM>event</EM> phase and a <EM>render</EM> phase. In case of an <EM>event</EM> in the portlet, it will always execute before the <EM>render</EM> phase. The <EM>event</EM> phase is typically for changing the state of the application. In a portlet, this is typically when a form is submitted. The <EM>render</EM> phase will then prepare and dispatch to the view. It's recommended that you set up the result from an action that is executed in the <EM>event</EM> phase to point to another action that is executed in the <EM>render</EM> phase, which again is responsible for dispatching to the actual view.</P>

<H2><A name="PortletPlugin-PortletResultDispatching"></A>Portlet Result Dispatching</H2>

<P>The <EM>struts-portlet-default</EM> package defines a special default Result Type, which is responsible for performing the result logic of an Action execution. Typically, this involves including a JSP for rendering, or preparing a render action if one is configured for the current event action.</P>

<P>This result type has three main modes of execution.</P>
<UL>
	<LI>If the Action is executed in the render phase, it will perform a PortletRequestDispatcher.include(req, res) to the resource specified in the <EM>location</EM> attribute.</LI>
	<LI>If the Action is executed in the event phase, and the result is an action mapping, it will set a render parameter on the ActionResponse to indicate which Action should be executed in the render phase. This follows good web application design, which promotes the use of a redirect after an event, which in this case means that an Action executed in the event phase will be followed by a redirect to an Action executed in the render phase.</LI>
	<LI>If the Action is executed in the event phase, and the result is not an action mapping, the result will prepare a special Action called &quot;renderDirect&quot; (specified in the <EM>struts-portlet-default</EM> package) whose sole purpose is to render the specified web resource (usually a JSP).</LI>
</UL>


<H3><A name="PortletPlugin-redirectAction"></A>redirectAction</H3>
<P>The action executed in event mode can pass render parameters to the next action to execute in render mode through parameters using the <EM>redirectAction</EM> result type:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>struts.xml</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
&lt;result type=<SPAN class="code-quote">&quot;redirectAction&quot;</SPAN> name=<SPAN class="code-quote">&quot;success&quot;</SPAN>&gt;
    &lt;param name=<SPAN class="code-quote">&quot;actionName&quot;</SPAN>&gt;displayCart&lt;/param&gt;
    &lt;param name=<SPAN class="code-quote">&quot;userId&quot;</SPAN>&gt;${userId}&lt;/param&gt;  
    &lt;!-- If you want to redirect to a different portlet mode, use the portletMode parameter 
    &lt;param name=<SPAN class="code-quote">&quot;portletMode&quot;</SPAN>&gt;view&lt;/param&gt;
    --&gt;
&lt;/result&gt;
</PRE>
</DIV></DIV>
<P>This will set up a <EM>render parameter</EM> called <EM>userId</EM> with the value of the <EM>userId</EM> property on the value stack. </P>

<P>You can also use the <EM>portletMode</EM> parameter to change to a different portlet mode.</P>

<H2><A name="PortletPlugin-s%3Aurlands%3Aformtags"></A>s:url and s:form tags</H2>

<P>URLs in a portlet is handled quite different than for a regular web application. There's no such thing as &quot;extension&quot;, there's simply an action name and a namespace, and they have to be specified using the respective tag attributes. URLs using the <EM>value</EM> attribute will be encoded as a resource URL and is only suitable for additional resources such as images and style sheets. </P>

<P>Example:</P>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh">Servlet</TH>
<TH class="confluenceTh">Portlet</TH>
</TR>
<TR>
<TD class="confluenceTd">&lt;s:url value=&quot;hello.action&quot;/&gt;</TD>
<TD class="confluenceTd">&lt;s:url action=&quot;hello&quot;/&gt;</TD>
</TR>
<TR>
<TD class="confluenceTd">&lt;s:url value=&quot;style.css&quot;/&gt;</TD>
<TD class="confluenceTd">&lt;s:url value=&quot;style.css&quot;/&gt;</TD>
</TR>
</TBODY></TABLE>
</DIV>


<P>In addition, there are some additional tag attributes that are portlet specific. These are:</P>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh">Name</TH>
<TH class="confluenceTh">Description</TH>
</TR>
<TR>
<TD class="confluenceTd">portletMode</TD>
<TD class="confluenceTd">The resulting portlet mode of the url</TD>
</TR>
<TR>
<TD class="confluenceTd">windowState</TD>
<TD class="confluenceTd">The resulting window state of the url</TD>
</TR>
<TR>
<TD class="confluenceTd">portletUrlType</TD>
<TD class="confluenceTd">Specifies if this is a <EM>render</EM> or an <EM>action</EM> url</TD>
</TR>
</TBODY></TABLE>
</DIV>


<P>Typical usage for the <EM>portletUrlType</EM> is if you have a <EM>delete</EM> link that removes something from a database. To ensure this is done in the event phase, as recommended by the portlet specification (since it is a change of state), the url can use this attribute, e.g. &lt;s:url action=&quot;deleteEntry&quot; portletUrlType=&quot;action&quot;/&gt;</P>

<H2><A name="PortletPlugin-Otherresources"></A>Other resources</H2>
<P><A href="struts-2-portlet-tutorial.html" title="Struts 2 Portlet Tutorial">Struts 2 Portlet Tutorial</A><BR>
<A href="http://jcp.org/aboutJava/communityprocess/final/jsr168/index.html" class="external-link" rel="nofollow">JSR168 Specification</A><BR>
<A href="http://jcp.org/aboutJava/communityprocess/final/jsr286/index.html" class="external-link" rel="nofollow">JSR286 Specification</A></P>
        </DIV>

                  <DIV class="tabletitle">
            Children
            <SPAN class="smalltext" id="show" style="display: inline;">
              <A href="javascript:showChildren()">Show Children</A></SPAN>
            <SPAN class="smalltext" id="hide" style="display: none;">
              <A href="javascript:hideChildren()">Hide Children</A></SPAN>
          </DIV>
          <DIV class="greybox" id="children" style="display: none;">
                                      <A href="struts-2-portlet-tutorial.html" title="Struts 2 Portlet Tutorial">Struts 2 Portlet Tutorial</A>
              <SPAN class="smalltext">(Apache Struts 2 Documentation)</SPAN>
              <BR>
                      </DIV>
        
      </DIV>
    </DIV>
    <DIV class="footer">
      Generated by
      <A href="http://www.atlassian.com/confluence/">Atlassian Confluence</A> (Version: 3.4.9 Build: 2042 Feb 14, 2011)
      <A href="http://could.it/autoexport/">Auto Export Plugin</A> (Version: 1.0.0-dkulp)
    </DIV>
  </BODY>
</HTML>